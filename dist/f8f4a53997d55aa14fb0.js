import{Message,log,Resampler}from"./_common";class Processor extends AudioWorkletProcessor{resampler;_initialized=!1;_stopProcessing=!1;options;constructor(e){super(),this.options=e.processorOptions,this.port.onmessage=e=>{e.data.message===Message.SpeechStop&&(this._stopProcessing=!0)},this.init()}init=async()=>{log.debug("initializing worklet"),this.resampler=new Resampler({nativeSampleRate:sampleRate,targetSampleRate:16e3,targetFrameSize:this.options.frameSamples}),this._initialized=!0,log.debug("initialized worklet")};process(e,s,t){if(this._stopProcessing)return!1;const i=e[0][0];if(this._initialized&&i instanceof Float32Array){const e=this.resampler.process(i);for(const s of e)this.port.postMessage({message:Message.AudioFrame,data:s.buffer},[s.buffer])}return!0}}registerProcessor("vad-helper-worklet",Processor);